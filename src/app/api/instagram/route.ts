import { PrismaClient } from "@prisma/client";
import { NextResponse } from "next/server";
import OpenAI from "openai";

import { SITE_URL } from "@/lib/metadata";
import { notifyProblem } from "@/lib/utils";

export const maxDuration = 60;

const prisma = new PrismaClient();

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function POST(request: Request) {
  const apiKey = request.headers.get("x-api-key");

  if (apiKey !== process.env.API_KEY) {
    return NextResponse.json({ error: "Invalid API key" }, { status: 401 });
  }

  try {
    const access_token = process.env.FACEBOOK_LONG_LIVE_TOKEN;
    const igUserId = process.env.IG_PAGE_ID;
    const apiVersion = process.env.FACEBOOK_API_VERSION;

    if (!access_token || !igUserId || !apiVersion) {
      return NextResponse.json({
        ok: false,
        message: "No se encontró un token de acceso válido.",
      });
    }

    const mostRelatedPosts: { id: string }[] = await prisma.$queryRaw`
      select p.id, 1-(n.embedding <=> ${embedding}::vector) as similarity 
      from "Post" p 
      left join "News" n on n.id = p."newId" 
      where p."createdAt" >= NOW() - INTERVAL '24 HOURS' and p."postedToInstagram" = false
      order by similarity desc 
      limit 5
    `;

    const lastPosts = await prisma.post.findMany({
      where: {
        id: {
          in: mostRelatedPosts.map((p) => p.id),
        },
      },
      select: {
        id: true,
        title: true,
        coverImage: true,
        content: true,
      },
    });

    if (!lastPosts.length) {
      return NextResponse.json({
        ok: false,
        message:
          "No se encontró una noticia válida para generar la descripción.",
      });
    }

    const creationIds = [];
    const articlesIds = [];
    let articles = "";
    let idx = 1;
    for (const lastPost of lastPosts) {
      const coverImageUrlEncoded = encodeURIComponent(
        lastPost.coverImage || `${SITE_URL}/icon.png`,
      );

      const [completionTitle] = await Promise.all([
        openai.chat.completions.create({
          messages: [
            {
              role: "system",
              content: `
            Eres un asistente que crea titulos concisos y atractivos a partir de un artículo. 
            Los titulos deben tener máximo 90 caracteres
            Solo responde con el titulo del artículo, sin ninguna introducción o comentario adicional.
          `,
            },
            {
              role: "user",
              content: `
            Aquí tienes un artículo sobre tecnología:
            ${lastPost.content}
            
            Por favor, proporciona un titulo adecuado.
          `,
            },
          ],
          model: "gpt-4o-mini",
        }),
      ]);

      const title =
        completionTitle?.choices?.[0]?.message?.content || lastPost.title;
      const titleUrlEncoded = encodeURIComponent(title.replaceAll(`"`, ""));

      const imageUrl = `${SITE_URL}/api/instagram/image?title=${titleUrlEncoded}&cover_image=${coverImageUrlEncoded}&api_key=${process.env.API_KEY}`;

      const res = await fetch(
        `https://graph.facebook.com/v19.0/${igUserId}/media`,
        {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: new URLSearchParams({
            image_url: imageUrl,
            is_carousel_item: "true",
            access_token,
          }),
        },
      );

      if (!res.ok) {
        continue;
      }

      const {
        id,
      }: {
        id: string;
      } = await res.json();
      creationIds.push(id);
      articlesIds.push(lastPost.id);
      articles += `${idx}. ${title}\n`;
      idx++;
    }

    const completionDescription = await openai.chat.completions.create({
      messages: [
        {
          role: "system",
          content: `
            Eres un asistente que crea descripciones concisas y atractivas para publicaciones en Instagram. 
            Las publicaciones deben estar diseñadas para atraer la atención de los seguidores interesados en noticias de tecnología. 
            La cuenta de Instagram es un sitio de noticias de tecnología llamado Tecnobuc.
            La publicacion consiste de varias noticias de tecnología, así que se te proporcionarán varior artículos y deberás crear una descripción general.
            Solo responde con el texto del resumen, sin ninguna introducción o comentario adicional. Al final haz una invitación a leer mas de las noticias en ${SITE_URL}.
            La descripción debe tener máximo 2200 caracteres.
          `,
        },
        {
          role: "user",
          content: `
        Aquí tienes varios artículos sobre tecnología:
        ${articles}
        
        Por favor, proporciona un resumen adecuado para una publicación en Instagram.
      `,
        },
      ],
      model: "gpt-4o-mini",
    });

    const caption =
      completionDescription.choices[0].message.content ||
      "Las últimas noticias de tecnología en Tecnobuc";

    const carouselResponse = await fetch(
      `https://graph.facebook.com/${apiVersion}/${igUserId}/media`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
          access_token,
          media_type: "CAROUSEL",
          children: creationIds.join(","),
          caption,
        }),
      },
    );

    if (!carouselResponse.ok) {
      const error = await carouselResponse.json();
      console.error(error);
      return NextResponse.json(
        { error: "Error creating carousel post" },
        { status: 500 },
      );
    }

    const {
      id: creation_id,
    }: {
      id: string;
    } = await carouselResponse.json();

    const res2 = await fetch(
      `https://graph.facebook.com/${apiVersion}/${igUserId}/media_publish`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
          creation_id,
          access_token,
        }),
      },
    );

    const data: {
      id: string;
    } = await res2.json();

    await prisma.post.updateMany({
      where: {
        id: {
          in: articlesIds,
        },
      },
      data: {
        postedToInstagram: true,
        instagramMediaId: data.id,
      },
    });

    return NextResponse.json({ success: true, data }, { status: 200 });
  } catch (error) {
    await notifyProblem("Publishing a new post to Instagram");
    if (error instanceof Error) {
      return NextResponse.json(
        { error: `Error al hacer la solicitud a la API: ${error.message}` },
        { status: 500 },
      );
    } else {
      return NextResponse.json(
        {
          error: "Error al hacer la solicitud a la API",
        },
        { status: 500 },
      );
    }
  }
}

// embedding of the word "technology"
const embedding = [
  -0.00875726, -0.030680062, -0.0046586776, 0.0016522821, 0.052477665,
  -0.04586195, 0.029283118, 0.042725414, -0.020321587, -0.01751452, 0.00375923,
  -0.0062697763, -0.03521354, -0.03545076, 0.020571982, 0.006780452,
  -0.02833425, -0.03442282, 0.023919377, 0.0067343265, 0.03049556, 0.0467581,
  0.019280469, -0.012210085, -0.022127071, 0.026976842, -0.0036570951,
  0.05882981, 0.0023375757, -0.03726942, 0.0021959043, -0.038771797,
  0.027016377, -0.044623148, 0.050764434, 0.008118092, 0.03534533, 0.005759101,
  -0.005027682, 0.0018911464, -0.016117577, -0.062414423, -0.01050344,
  0.067580484, -0.008078556, -0.0029240288, -0.07622572, -0.017185053,
  0.008981299, 0.03376388, 0.011808134, -0.054559905, -0.026014796, 0.007867697,
  -0.019320006, 0.010589102, -0.01588036, 0.027859816, -0.011992636,
  0.025355859, -0.02050609, -0.019399077, 0.052767597, -0.033289447,
  -0.027728029, -0.043410707, -0.02153403, 0.046125524, -0.05316296,
  0.0028185989, 0.0072746538, 0.02822882, -0.03650506, 0.029757552, 0.003017927,
  0.03389567, -0.05007914, 0.028703254, 0.07554043, 0.009739075, 0.003452825,
  -0.009739075, -0.030653704, -0.003429762, -0.0026456283, -0.013547725,
  -0.03842915, -0.039826095, -0.013475242, -0.025065927, -0.043832425,
  0.021507673, 0.027569884, 0.08871915, -0.0051990054, 0.0045071226,
  0.0015863886, -0.0048036436, 0.008104913, 0.042514555, -0.016209826,
  -0.04586195, -0.0045861946, -0.0011860849, 0.03690042, 0.0009603993,
  -0.012341872, -0.021138668, -0.025830293, 0.064628445, -0.06568275,
  -0.040353242, -0.0566685, 0.033842955, 0.026528765, -0.024499241, 0.05050086,
  -0.03637327, 0.034264673, -0.019913048, -0.08012662, -0.0040458674,
  -0.024855068, 0.009271231, -0.0025747926, -0.0025995027, -0.02482871,
  -0.0063224914, -0.00989063, -0.029704837, 0.0123155145, -0.00623024,
  0.015234602, -0.0064443946, 0.008170807, -0.03255144, 0.0051660584,
  0.031259924, -0.033131305, 0.028755968, 0.022285217, -0.0022683872,
  -0.012203496, 0.04016874, -0.0040458674, -0.0053835073, -0.020796021,
  0.017949417, 0.042514555, 0.056194067, -0.044122357, 0.028492395,
  -0.018885108, -0.016947836, -0.012710876, -0.010365064, 0.006203883,
  0.033922028, -0.01864789, 0.0006095158, -0.020492911, -0.020427017,
  -0.029177688, -0.016947836, -0.0054592853, 0.049525633, 0.009284409,
  -0.00535715, -0.048181403, -0.01783081, -0.016302077, -0.02915133,
  -0.020163443, 0.05656307, -0.01256591, 0.0036505056, 0.05160787, -0.044992153,
  -0.041776545, -0.037954718, -0.0013401111, 0.031207211, -0.047680613,
  -0.011307343, -0.014391163, -0.044016927, -0.0047311606, 0.008309184,
  0.006602539, 0.0028614297, -0.040537745, 0.039193515, 0.039615236,
  0.025184536, 0.025500825, -0.0029322654, -0.043647923, -0.038165577,
  0.050316356, -0.04027417, 0.04385878, -0.019267289, 0.0025929133,
  -0.0100817215, -0.05390097, -0.016420687, -0.046573598, 0.024169775,
  -0.009732486, -0.035740692, 0.011518202, -0.020413838, 0.0032946803,
  0.015471818, -0.021138668, 0.005564715, 0.0276226, 0.025540361, -0.013448885,
  0.038929943, -0.016209826, 0.00084838015, 0.0128822, 0.022377469,
  -0.030179271, 0.03811286, -0.023339516, -0.028597824, 0.03679499, -0.04501851,
  0.011775187, 0.0058875936, -0.021165026, -0.023893021, -0.00008597056,
  0.043621566, -0.01925411, -0.0031645403, -0.027807102, -0.019768082,
  0.0027477634, -0.009178979, -0.031602573, 0.02822882, -0.04820776,
  0.034449175, 0.036241483, 0.0137322275, -0.012210085, -0.013336865,
  0.022614686, -0.028070675, 0.013317097, -0.018700605, 0.107011214,
  -0.024736458, -0.018792856, 0.009772021, 0.0074986923, 0.03811286,
  -0.017158695, -0.016750155, -0.03215608, -0.023774412, -0.026752803,
  0.009515037, -0.001797248, 0.02082238, 0.007814981, -0.03842915, 0.05079079,
  -0.0033062117, 0.0067442106, -0.016341614, -0.06346872, -0.0061314,
  -0.011089894, 0.045730162, -0.0027494107, 0.06389044, -0.021692175,
  0.005518589, 0.014641559, -0.027675314, -0.027833458, 0.035898834,
  0.00046949193, 0.021309992, 0.04130211, 0.00087309023, 0.04399057,
  -0.00262586, -0.025685327, -0.025896186, 0.019926226, 0.05450719,
  0.0126845185, -0.0136531545, -0.0077952133, -0.07554043, 0.010463905,
  -0.026752803, 0.0045170067, 0.014641559, -0.02494732, 0.08350038,
  -0.0013944734, -0.019820796, 0.0093371235, -0.008678188, -0.010068542,
  0.0012462127, 0.049103916, -0.0037987663, -0.044754937, -0.0058447625,
  -0.011900385, 0.0015460287, -0.02801796, -0.096310094, -0.014799704,
  -0.021283634, 0.029124973, -0.028861398, 0.037638426, -0.036004264,
  -0.018002132, -0.007986305, 0.0141012315, -0.04348978, -0.034870896,
  0.013837657, 0.015788108, 0.007992894, 0.025672149, 0.031233568, 0.015735393,
  0.030864565, -0.04314713, -0.036689557, -0.02720088, -0.046942603,
  -0.02410388, 0.02564579, 0.021072775, 0.004009626, -0.0023738171,
  -0.012783359, -0.008816564, 0.05687936, -0.029124973, 0.0022782714,
  0.02245654, 0.024367455, -0.034291033, -0.013079881, 0.025685327,
  0.0072087604, -0.013013987, -0.024762817, -0.0113337, 0.052925743,
  0.0147733465, 0.052424952, -0.0290459, 0.043832425, -0.048761267,
  -0.036004264, -0.045914665, -0.05213502, -0.050817147, -0.012170549,
  -0.0028597824, 0.026146581, -0.026937306, -0.010516619, 0.040616818,
  0.052688524, -0.034396462, 0.007366905, 0.048682194, 0.013205078, 0.030258343,
  -0.07380084, 0.016526116, 0.02050609, -0.029810267, -0.011155787,
  -0.008157629, -0.016763333, 0.05337382, -0.032498725, -0.03060099, -0.0515288,
  -0.012770181, 0.011992636, 0.011920153, 0.03719035, 0.02192939, -0.03165529,
  0.022851901, -0.004704803, -0.023062762, 0.055456057, -0.0035187185,
  -0.03039013, -0.019240933, 0.024406992, 0.043516137, 0.036953133, 0.02502639,
  -0.03845551, 0.036215127, 0.020071192, -0.016170291, -0.030627348,
  0.0034561194, 0.0014018865, 0.018581996, -0.024762817, -0.0048069386,
  0.00033296863, -0.0045170067, -0.01524778, 0.012328694, 0.03924623,
  0.014272555, 0.0036307375, 0.03956252, -0.042303693, 0.01421984, 0.011709293,
  -0.002581382, 0.044175074, -0.0047311606, 0.0051594693, 0.0018384316,
  0.0327623, 0.005179237, 0.0048794216, -0.00689906, 0.024762817, 0.0257644,
  -0.03850822, 0.005179237, -0.012638393, -0.06431216, 0.002174489,
  -0.024696924, -0.065155596, 0.030732777, 0.004339094, 0.013046933,
  0.023458123, -0.029994769, -0.009534804, 0.01627572, -0.013666334, 0.01627572,
  0.03492361, -0.027253594, -0.019544043, -0.004121645, 0.0038251237,
  0.015260959, 0.0089681195, -0.010048775, 0.003739462, -0.008487096,
  -0.00484318, 0.01958358, 0.035477117, 0.0068792924, -0.035503473,
  -0.018740142, 0.019754903, 0.03845551, 0.0034660036, 0.013929908,
  0.0031282988, -0.03581976, 0.022548791, -0.03194522, 0.0120914765,
  -0.009903809, 0.042409122, 0.028386965, 0.01935954, -0.014285733,
  -0.0012453891, 0.0591461, -0.042778127, 0.05977868, -0.014575665,
  -0.012005814, 0.017132336, -0.071955815, -0.0067738625, 0.00895494,
  -0.012809717, -0.00066511356, -0.019939404, -0.05656307, 0.002760942,
  -0.005396686, 0.033922028, 0.02307594, 0.024696924, 0.00027428212,
  0.0057129753, 0.03492361, -0.015274137, 0.0004974967, 0.016947836,
  -0.023089118, 0.0013096354, -0.016829226, 0.0113468785, -0.006447689,
  -0.042066477, -0.004645499, 0.008091735, -0.032077007, 0.032735944,
  0.011465487, -0.03584612, -0.018265707, -0.026700089, -0.050342713,
  -0.029256761, 0.0002812833, -0.025685327, -0.02689777, -0.01792306,
  0.005647082, -0.015603606, -0.004500533, -0.006243419, -0.047232535,
  0.008533222, 0.0366632, 0.013982623, -0.014246197, 0.0026472756, -0.03297316,
  0.0302847, 0.008513453, -0.015010563, 0.010747246, 0.038877226, 0.058671664,
  -0.033632096, 0.013679512, 0.0008945057, 0.011913564, -0.009304177,
  -0.0031497143, -0.02822882, 0.0060819797, -0.012223263, -0.028597824,
  -0.00824329, 0.039272588, -0.029731194, -0.02215343, 0.041881975,
  -0.014628381, 0.0011531381, -0.038982656, -0.0072746538, -0.0100817215,
  0.028887756, 0.021599924, -0.034739107, 0.0044016927, 0.02442017,
  -0.008974709, -0.009225105, 0.032340582, -0.0068858815, -0.041091252,
  0.038666368, -0.03297316, -0.0024726575, 0.00022671519, -0.051950518,
  0.014496593, -0.017145516, -0.0061215158, 0.020756485, 0.014351627,
  0.017053265, -0.007735909, -0.022417003, 0.0030541685, -0.029546693,
  -0.006839756, 0.0013590556, -0.017461805, -0.0046422044, -0.014826061,
  -0.02009755, 0.031444427, 0.002116832, 0.012407766, -0.0029899222,
  -0.005689913, 0.005884299, -0.039219875, 0.008790207, 0.02194257, 0.017290482,
  0.008388256, -0.015854001, -0.037743855, -0.012183728, 0.028255178,
  0.018147098, 0.027543526, 0.022548791, -0.0764893, -0.021085953, 0.0064674574,
  -0.013587262, 0.010879034, -0.010121258, -0.026660552, 0.0039206697,
  0.005083692, -0.026752803, 0.019464971, 0.016618367, 0.0063850903,
  -0.0037625248, -0.040326886, 0.00051191094, 0.027886173, 0.027938887,
  0.019662652, -0.034449175, -0.021678995, 0.019728545, -0.017224588,
  -0.024986854, 0.04119668, 0.03782293, -0.049710136, 0.00021971398,
  0.0076107113, 0.005060629, -0.0016967603, -0.015788108, 0.0076304795,
  -0.0070835627, 0.038191933, -0.017633129, -0.01905643, 0.020954166,
  0.03513447, -0.016354792, -0.0019586873, -0.027332667, 0.010061953,
  -0.007037437, -0.0066124233, 0.018542461, 0.013264382, 0.014377984,
  0.012664751, 0.008111503, 0.024288382, 0.054559905, 0.019240933, 0.007801803,
  0.020058013, -0.016947836, 0.017870346, -0.04008967, -0.0051528797,
  0.058460806, 0.0119465105, -0.02225886, -0.026331084, 0.0039009014,
  0.010859266, 0.005149585, 0.022127071, 0.029836625, 0.023115477, -0.018832393,
  -0.02327362, -0.011261217, 0.049393848, 0.0012116187, 0.012605446,
  -0.02059834, 0.043911498, 0.027833458, -0.03581976, 0.0066585485, 0.03350031,
  -0.013409348, -0.03492361, -0.040933106, -0.02082238, 0.013929908,
  -0.016354792, -0.027148165, 0.020031655, 0.043041702, 0.007973126,
  -0.037981074, -0.013475242, 0.0035879067, 0.038481865, 0.0027905942,
  -0.0013417585, 0.021652639, 0.016433865, -0.00772932, 0.00069435383,
  -0.04504487, -0.015814465, -0.002416648, -0.036188766, -0.002271682,
  -0.044254143, 0.058355376, -0.013409348, -0.018502925, -0.014918312,
  0.02277283, 0.011906974, -0.020176621, 0.028413322, 0.0063060177, -0.03450189,
  -0.050975293, 0.0044873543, -0.0012297394, 0.009851093, -0.008585936,
  -0.006078685, 0.001942214, 0.021178205, 0.02472328, 0.003522013, 0.020611519,
  0.030521918, 0.007472335, -0.038060147, 0.008691367, -0.0079994835,
  -0.013040344, -0.03176072, -0.026238833, -0.026489228, -0.0352399,
  -0.008533222, -0.011386415, 0.019702187, 0.021599924, 0.0009900514,
  0.004233664, 0.008091735, -0.013679512, -0.0035681387, 0.0007371847,
  -0.02709545, 0.011017411, 0.010160794, -0.023141833, 0.006098453, 0.025421752,
  -0.016934656, 0.02090145, -0.02123092, -0.0117949555, 0.0226674, 0.019148681,
  -0.02854511, -0.031180853, -0.06325786, -0.0040755193, -0.0009875804,
  -0.012124423, 0.0103782425, 0.0071230987, 0.0025467877, -0.03297316,
  0.00530773, 0.01863471, -0.026449693, 0.0083750775, 0.033632096, 0.012190317,
  0.022838723, -0.092672765, -0.00793359, -0.009001066, 0.013000808, 0.02092781,
  0.0013186957, 0.001228092, 0.027279953, 0.026765982, -0.033632096,
  -0.003923964, -0.041460257, -0.01822617, -0.023629446, 0.040774964,
  -0.0018417262, 0.010516619, -0.026924126, -0.02915133, 0.018147098,
  -0.03911444, 0.021889856, 0.002920734, -0.01698737, -0.033236735, 0.027701672,
  -0.010701122, 0.0071692243, -0.0015419103, 0.008078556, 0.010635228,
  -0.0058612362, 0.014351627, 0.06810763, 0.0040854034, -0.0053933915,
  0.013758585, 0.0054428116, 0.03336852, -0.009027423, -0.0016827579,
  0.013943086, 0.012552732, 0.021995286, -0.020545626, -0.022417003,
  -0.008058788, 0.020413838, -0.012710876, 0.034396462, -0.036004264,
  -0.035529833, -0.009330534, -0.026634194, -0.00024524776, 0.014061695,
  0.010622049, -0.011393004, -0.027464455, -0.0058480576, 0.020123906,
  0.012651572, -0.0099367555, -0.038086504, 0.032841373, 0.030653704,
  -0.004381925, 0.006398269, -0.028149748, 0.018384315, 0.02668691, 0.026212476,
  -0.0115709165, 0.0676332, 0.0038877227, -0.015274137, -0.011992636,
  0.016262542, 0.042804487, -0.031180853, 0.006852935, 0.008085146,
  -0.030416489, 0.0405641, -0.013007398, 0.015616784, -0.009139443, 0.007571175,
  0.01514235, -0.035266258, 0.040616818, 0.023234084, 0.02297051, 0.013890372,
  0.008269647, -0.000028802711, -0.034897253, 0.017198231, -0.017198231,
  -0.0038613651, -0.0034264675, 0.020492911, -0.01989987, -0.02100688,
  -0.0364787, 0.04544023, -0.00113337, -0.014957848, 0.031022709, -0.010826319,
  -0.00633567, -0.021072775, 0.0073405476, 0.0047311606, -0.025632612,
  0.007544818, 0.0038185343, 0.0074921027, -0.0027988309, -0.029309476,
  0.031338997, 0.016394328, -0.028782327, -0.016657904, -0.03626784,
  0.0033836365, 0.0046323203, 0.04388514, 0.036215127, 0.0012429181,
  0.016671082, 0.0059732553, -0.0066816113, 0.0045170067, -0.009877452,
  -0.014760167, 0.002344165, 0.03850822, -0.055456057, 0.0037526407,
  0.007900643, 0.018990537, -0.019754903, -0.025619434, 0.003811945,
  -0.0020064602, 0.01318531, 0.0061215158, -0.0065860655, 0.023985272,
  0.005261604, -0.045598373, 0.03265687, 0.014483415, -0.02812339, 0.019451791,
  0.0259489, 0.0051034596, 0.007044026, 0.070532516, -0.018661069, 0.008434381,
  0.009218515, 0.010734068, 0.008216932, 0.0021728417, -0.02411706,
  -0.015353209, 0.037559353, 0.017448626, 0.0079270005, 0.041038536,
  0.007116509, -0.03521354, -0.035872478, -0.002456184, 0.005060629,
  0.014272555, -0.015234602, 0.01339617, 0.0011564328, 0.002945444,
  -0.030416489, -0.0030047484, 0.051766016, 0.020137085, -0.030442845,
  0.0012725702, -0.0065399404, 0.050000068, 0.0004550777, -0.0036043802,
  0.02380077, 0.044227786, 0.004698214, -0.0257644, -0.024406992, 0.032788657,
  0.007129688, -0.03679499, -0.11154469, 0.025329502, 0.004780581, -0.012743823,
  0.024696924, 0.006945186, 0.010371653, -0.044754937, -0.011788365,
  0.007834749, 0.020361124, 0.042988986, 0.008948351, 0.025922544, -0.03162893,
  -0.0047871703, -0.023813948, -0.0034363514, 0.00074871606, 0.007867697,
  -0.018661069, 0.0037559355, 0.013850836, -0.014628381, -0.013132595,
  0.012335283, 0.00226674, 0.04833955, -0.01783081, -0.003302917, 0.0074327984,
  0.02091463, 0.0003774468, -0.00081213866, 0.0056701447, -0.0048168222,
  0.000052483225, 0.0018038374, 0.008328952, 0.020492911, -0.047048032,
  -0.016592009, 0.014285733, 0.002775768, 0.00033008578, 0.0064839306,
  0.00026522175, -0.027991602, 0.042699054, -0.0045598373, 0.019109145,
  0.055508774, 0.0070637944, -0.016644724, -0.022944152, -0.039641593,
  -0.0054428116, -0.0035154237, -0.013231436, -0.0025023096, 0.0025303145,
  0.022496076, -0.007261475, -0.002174489, 0.010187151, -0.014443878,
  -0.02215343, 0.0096402345, 0.04844498, -0.007373494, 0.002383701, 0.018898286,
  -0.00484318, -0.007986305, -0.00093404186, -0.0005147938, -0.00022795069,
  -0.03194522, 0.009093317, -0.022851901, -0.028044319, -0.0302847,
  -0.022601506, 0.008045609, -0.019807618, 0.014074874, -0.009113085,
  -0.00037971188, -0.0015048452, 0.0046586776, -0.015933074, 0.0035253079,
  -0.009020834, -0.060516685, -0.010654996, -0.012256211, -0.018081205,
  0.012598857, 0.026634194, 0.006572887, 0.043674283, 0.04380607, -0.027438097,
  0.0044148713, 0.031470787, -0.009541394, 0.0019191512, -0.02659466,
  -0.039536163, -0.004441229, -0.019860333, 0.018740142, 0.0043852194,
  0.0059666657, 0.02020298, 0.01174883, 0.01790988, 0.019504506, 0.018687427,
  -0.030047484, -0.006500404, -0.061043836, 0.007689784, -0.003956911,
  -0.02658148, 0.023036404, -0.02699002, -0.02946762, 0.024538778, 0.020875094,
  0.03534533, -0.007821571, -0.03039013, 0.0013170484, 0.026818696,
  -0.0077029625, 0.015801286, -0.017501341, 0.000078042736, -0.0083750775,
  -0.011827902, 0.007182403, -0.00026130932, 0.00014496593, -0.012500017,
  0.006431216, -0.010338707, 0.008632062, 0.020440197, -0.016895121, 0.11449673,
  -0.008131271, -0.016526116, 0.0107538365, -0.003352337, 0.008203753,
  -0.012730644, 0.00803902, -0.02647605, 0.0049321363, 0.000053538555,
  -0.019636294, 0.005624019, -0.004381925, -0.023616267, 0.01905643,
  -0.00011696115, -0.05118615, 0.008974709, -0.02082238, 0.017132336,
  0.020453375, -0.017395912, -0.01863471, 0.033922028, 0.00064328633,
  0.010424368, -0.02337905, 0.013877193, -0.008381667, 0.011966279,
  0.0011696115, 0.008019252, 0.021178205, 0.009172389, -0.013468653,
  -0.01678969, -0.009508447, -0.023629446, -0.0033589264, 0.033131305,
  -0.0073866732, 0.012994219, -0.019122325, 0.01360044, -0.00041945398,
  -0.022417003, -0.005439517, 0.010483673, -0.01989987, -0.0027889467,
  0.017198231, 0.031997934, -0.010279402, 0.009205337, -0.029731194,
  -0.022324754, 0.0046125525, 0.057353795, -0.010654996, -0.038086504,
  -0.001293162, -0.021112312, 0.029019544, -0.018410673, -0.022232503,
  -0.004460997, -0.0064740465, 0.008467328, 0.00094804424, 0.026502408,
  -0.012275979, 0.022179788, -0.048128687, -0.0032815016, 0.015208244,
  0.023787592, 0.0000029793691, -0.053769182, -0.011821313, 0.026238833,
  0.052372236, 0.0239062, 0.01524778, -0.03911444, -0.00906696, -0.032235153,
  -0.0123879975, -0.013363223, 0.004895895, 0.011959689, 0.009172389,
  0.000055185894, 0.041091252, -0.023023225, -0.006292839, -0.022127071,
  -0.026541945, -0.012071708, -0.0023573437, -0.0001827518, 0.007814981,
  0.0047739916, 0.037691142, -0.027332667, -0.019201396, -0.032683227,
  -0.03906173, -0.004978262, 0.00081708067, -0.007841339, 0.031259924,
  0.020519268, -0.013317097, 0.03977338, 0.014865597, -0.003095352,
  -0.013382991, -0.004016215, -0.020743307, 0.024775995, -0.020110728,
  0.022061178, -0.006793631, -0.023761233, -0.012816306, 0.017250946,
  0.0059897285, 0.00046578542, -0.00793359, 0.020466553, 0.010536388,
  -0.014971027, -0.009561162, 0.018581996, -0.015603606, -0.014588844,
  -0.04309442, 0.018898286, -0.0350554, 0.022430183, -0.009844504, 0.029862981,
  0.020519268, 0.014984205, 0.020637877, 0.019095967, 0.009963113, -0.009765432,
  0.0027774153, -0.0034132886, 0.034475535, -0.012117834, -0.027016377,
  0.028597824, 0.021889856, -0.00886269, -0.016328435, 0.015511354, 0.047522467,
  -0.011939921, -0.003419878, -0.01112284, 0.008434381, -0.014826061,
  -0.004648794, -0.019095967, 0.029546693, 0.0043292097, 0.018212993,
  0.010562745, -0.028386965, 0.021336349, 0.03861365, 0.034343746, -0.042567268,
  -0.041697472, 0.04030053, -0.010035596, -0.03726942, 0.0119531, -0.010589102,
  0.0015773282, 0.008803385, -0.006408153, 0.016512938, -0.027306309,
  -0.006717853, 0.002561614, -0.05039543, 0.0026505701, 0.009745664,
  0.0057327435, 0.027042735, 0.015208244, -0.010424368, -0.02245654,
  -0.031892505, -0.013864014, 0.005739333, -0.0024578315, -0.027227238,
  -0.01277677, 0.029678479, 0.02502639, -0.005139701, -0.018054847, 0.005429633,
  -0.00700449, 0.011162377, -0.0141012315, -0.015313674, -0.0008442618,
  0.037664786, 0.003045932, -0.010114668, 0.01349501, 0.05719565, -0.03286773,
  -0.030100198, -0.010490262, -0.053927325, 0.014153946, 0.005182532,
  -0.035977907, -0.023734877, 0.013429116, -0.0070506157, -0.01287561,
  0.0034066993, 0.008427792, 0.029493976, 0.038929943, 0.0011193675,
  0.0054131597, 0.00690565, -0.026976842, -0.025289966, 0.029493976,
  0.017158695, -0.012341872, 0.0010963049, -0.02544811, 0.01721141, 0.033131305,
  0.02894047, 0.05305753, 0.036953133, 0.001985045, 0.026502408, -0.0048168222,
  0.015669499, -0.008836333, 0.0025714978, -0.019847153, -0.0041908333,
  0.019833975, -0.007057205, -0.0012758649, -0.016974192, 0.018937822,
  0.0030212218, -0.0023425177, -0.030653704, -0.014312091, 0.027016377,
  -0.012453891, -0.008381667, -0.009501858, 0.020848736, -0.020176621,
  0.0049288417, -0.0127635915, 0.01978126, -0.023352694, 0.053637393,
  -0.0031744244, -0.015998967, 0.010641817, -0.0109778745, -0.023655804,
  -0.027253594, -0.016618367, -0.0075382283, 0.0087440815, 0.015774928,
  -0.03176072, 0.03176072, 0.013218257, 0.018489745, -0.005446106, 0.04359521,
  0.014167125, 0.004938726, -0.008493685, -0.0019290353, 0.00813786,
  0.004760813, 0.003574728, -0.023405408, 0.015946252, -0.008737492,
  0.033842955, 0.0015419103, 0.019807618, 0.013890372, -0.0026439808,
  -0.0122628, 0.0004596079, -0.0060655065, 0.031497143, 0.010239867,
  -0.017633129, 0.022443362, -0.015854001, 0.017580414, 0.028861398,
  0.007617301, 0.012453891, 0.0006095158, 0.02709545, 0.021494493, 0.014127589,
  -0.052899387, 0.057142932, -0.012427534, 0.007689784, 0.01318531, 0.04225098,
  0.01783081, 0.0068463455, 0.01864789, -0.033922028, -0.042092834, 0.050869863,
  0.0051858267, 0.00046866827, -0.011373236, -0.0036439162, -0.015735393,
  -0.007057205, -0.034185603, -0.0013722343, -0.016961014, 0.0077820346,
  0.051686943, 0.0067112637, 0.008309184, -0.004592784, 0.001869731,
  0.009356892, -0.021270456, -0.021059595, -0.012915147, -0.030653704,
  0.010786783, 0.013719048, -0.0073866732, -0.0003937143, -0.0065366453,
  0.020756485, 0.025105463, 0.016104396, -0.00989063, 0.0071560456, 0.058987953,
  -0.0053439713, -0.016025325, -0.043832425, -0.008895637, -0.018924642,
  0.022627864, 0.008809975, -0.024644207, 0.023682162, -0.027174523,
  0.013574082, -0.0039206697, -0.038402792, 0.03442282, 0.004039278, -0.0490512,
  -0.008006073, -0.0040228046, 0.0146942735, -0.02709545, -0.026937306,
  -0.0009818147, 0.009139443,
];
